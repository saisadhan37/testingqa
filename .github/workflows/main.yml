name: CodeGuru Reviewer GitHub Actions Integration
on: [pull_request, push, schedule]
jobs:
  CodeGuru-Reviewer-Actions:
    runs-on: ubuntu-latest
    steps:
        - name: Checkout repository
          uses: actions/checkout@v2
          with:
            fetch-depth: 0   # Required
      
        - name: Configure AWS Credentials
          uses: aws-actions/configure-aws-credentials@v1
          if: ${{ always() }} # This ensures that your workflow runs successfully
          with:
            aws-access-key-id: AKIAR5E5PCV5JIA7EA7W
            aws-secret-access-key: YlPHV8bJIRzA483kTpOT9Mu9dN34/ZkfL3yroa+3
            aws-region: us-west-2

        - name: AWS CodeGuru Reviewer Scanner
          uses: aws-actions/codeguru-reviewer@v1.1
          if: ${{ always() }} 
          with:
            build_path: target # build artifact(s) directory
            s3_bucket: codeguru-reviewer-codeguru  # S3 Bucket with "codeguru-reviewer-*" prefix
        
        - name: Upload review result
          if: ${{ always() }}
          uses: github/codeql-action/upload-sarif@v1
          with:
            sarif_file: codeguru-results.sarif.json
